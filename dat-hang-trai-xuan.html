<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Đặt món hội trại</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    nav { background: #222; padding: 10px; display: flex; justify-content: space-around; position: sticky; top: 0; }
    nav button { background: none; border: none; color: #fff; font-size: 14px; }
    .container { padding: 12px; }
    .card { background: #fff; padding: 14px; border-radius: 10px; margin-bottom: 12px; }
    h2 { margin: 0 0 10px; font-size: 18px; }
    label { display: block; margin-top: 8px; font-weight: 600; }
    select, input { width: 100%; padding: 10px; margin-top: 4px; border-radius: 6px; border: 1px solid #ccc; }
    button { width: 100%; padding: 12px; margin-top: 12px; border-radius: 8px; border: none; background: #ff5722; color: #fff; }
    button.secondary { background: #555; }
    .hidden { display: none; }
    .qty { display:flex; gap:10px; justify-content:center; align-items:center; }
    .qty button { width:36px; height:36px; border-radius:50%; padding:0; }
    table { width:100%; border-collapse:collapse; margin-top:10px; font-size:13px; }
    th, td { border-bottom:1px solid #ddd; padding:6px; }
  </style>
</head>

<body>

<nav>
  <button onclick="showSection('single')">Món lẻ</button>
  <button onclick="showSection('combo')">Combo</button>
  <button onclick="showSection('cart')">Giỏ hàng</button>
</nav>

<div class="container">

<div class="card">
  <h2>Thông tin nhận hàng</h2>
  <label>Tên khách *</label>
  <input id="customerName">

  <label>Lớp / địa chỉ *</label>
  <input id="classAddress">

  <label>Link Facebook *</label>
  <input id="campName">

  <label>Khung giờ *</label>
  <select id="pickupTime">
    <option value="">-- Chọn --</option>
    <option>8:00 – 9:00</option>
    <option>9:00 – 10:00</option>
    <option>10:00 – 11:00</option>
    <option>13:00 – 14:00</option>
    <option>14:00 – 15:00</option>
  </select>

  <button class="secondary" onclick="saveCustomer()">Lưu thông tin</button>
</div>

<div id="single" class="card">
  <h2>Món lẻ</h2>
  <select id="singleItem" onchange="toggleDrink(this.value)">
    <option disabled selected>Chọn món</option>
    <option>Gà</option>
    <option>Pudding trứng</option>
    <option>Pudding hồng trà</option>
    <option>Tàu hũ Singapore</option>
    <option>Trà chanh dây</option>
  </select>

  <div id="drinkOpt" class="hidden">
    <label>Đá</label>
    <select id="singleIce">
      <option>Đá bình thường</option>
      <option>Ít đá</option>
      <option>Không đá</option>
    </select>

    <label>Thạch</label>
    <select id="singleJelly">
      <option>Thạch bình thường</option>
      <option>Không thạch</option>
    </select>
  </div>

  <div class="qty">
    <button onclick="qty('singleQty',-1)">-</button>
    <input id="singleQty" type="number" value="1">
    <button onclick="qty('singleQty',1)">+</button>
  </div>

  <button onclick="addSingle()">Thêm vào giỏ</button>
</div>

<div id="combo" class="card hidden">
  <h2>Combo</h2>
  <select id="comboType" onchange="renderCombo()">
    <option disabled selected>Chọn combo</option>
    <option>Combo 1</option>
    <option>Combo 2</option>
    <option>Combo 3</option>
  </select>

  <div id="comboOptions"></div>

  <div class="qty">
    <button onclick="qty('comboQty',-1)">-</button>
    <input id="comboQty" type="number" value="1">
    <button onclick="qty('comboQty',1)">+</button>
  </div>

  <button onclick="addCombo()">Thêm combo</button>
</div>

<div id="cart" class="card hidden">
  <h2>Giỏ hàng</h2>
  <table>
    <thead>
      <tr><th>Loại</th><th>Món</th><th>SL</th><th></th></tr>
    </thead>
    <tbody id="cartTable"></tbody>
  </table>
  <button onclick="submitCart()">Xác nhận đặt món</button>
</div>

</div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyJEe0at4ZpeaLubg73Df61jeBt_3OZ50UR19WQYsKRqjKrKyTXzcwc_ansXohI1pqalg/exec';
let cart = [];

function showSection(id){
  ['single','combo','cart'].forEach(s=>document.getElementById(s).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id==='cart') renderCart();
}

function saveCustomer(){
  if(!customerName.value||!classAddress.value||!campName.value||!pickupTime.value){
    alert('Nhập đủ thông tin');
    return;
  }
  localStorage.setItem('customer',JSON.stringify({
    ten:customerName.value,
    lop:classAddress.value,
    trai:campName.value,
    gio:pickupTime.value
  }));
  alert('Đã lưu');
}

function toggleDrink(v){
  drinkOpt.classList.toggle('hidden',v!=='Trà chanh dây');
}

function qty(id,d){
  const i=document.getElementById(id);
  i.value=Math.max(1,parseInt(i.value)+d);
}

function renderCombo(){
  comboOptions.innerHTML='';

  if(['Combo 1','Combo 3'].includes(comboType.value)){
    comboOptions.innerHTML+=`
      <label>Đá</label>
      <select id="comboIce">
        <option>Đá bình thường</option>
        <option>Ít đá</option>
        <option>Không đá</option>
      </select>

      <label>Thạch</label>
      <select id="comboJelly">
        <option>Thạch bình thường</option>
        <option>Không thạch</option>
      </select>
    `;
  }

  if(comboType.value==='Combo 1'){
    comboOptions.innerHTML+=`
      <label>Tráng miệng</label>
      <select id="comboDessert1">
        <option>Pudding trứng</option>
        <option>Pudding hồng trà</option>
        <option>Tàu hũ Singapore</option>
      </select>`;
  }

  if(comboType.value==='Combo 2'){
    comboOptions.innerHTML+=`
      <label>Tráng miệng 1</label>
      <select id="comboDessert1">
        <option>Pudding trứng</option>
        <option>Pudding hồng trà</option>
        <option>Tàu hũ Singapore</option>
      </select>
      <label>Tráng miệng 2</label>
      <select id="comboDessert2">
        <option>Pudding trứng</option>
        <option>Pudding hồng trà</option>
        <option>Tàu hũ Singapore</option>
      </select>`;
  }
}

function addSingle(){
  cart.push({
    loai:'Món lẻ',
    noiDung: singleItem.value,
    soLuong: singleQty.value
  });
  alert('Đã thêm');
}

function addCombo(){
  let desserts=[];
  if(comboDessert1) desserts.push(comboDessert1.value);
  if(comboDessert2) desserts.push(comboDessert2.value);

  cart.push({
    loai:'Combo',
    noiDung: comboType.value,
    chiTiet:{
      trangmieng: desserts,
      da: comboIce?.value||'',
      thach: comboJelly?.value||''
    },
    soLuong: comboQty.value
  });
  alert('Đã thêm combo');
}

function renderCart(){
  cartTable.innerHTML='';
  cart.forEach((c,i)=>{
    let detail=c.noiDung;
    if(c.chiTiet){
      detail+=`<br><small>${c.chiTiet.trangmieng.join(', ')}</small>`;
    }
    cartTable.innerHTML+=`
      <tr>
        <td>${c.loai}</td>
        <td>${detail}</td>
        <td>${c.soLuong}</td>
        <td><button onclick="cart.splice(${i},1);renderCart()">Xóa</button></td>
      </tr>`;
  });
}

function submitCart(){
  const customer = JSON.parse(localStorage.getItem('customer'));
  if(!customer||!cart.length){ alert('Thiếu thông tin'); return; }

  fetch(SHEET_URL,{
    method:'POST',
    mode:'no-cors',
    body:JSON.stringify({customer,cart})
  }).then(()=>{
    localStorage.clear();
    cart=[];
    location.href='thankyou.html';
  });
}
</script>

</body>
</html>
